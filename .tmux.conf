# 使うshellをfishにする
set -g default-shell $SHELL

# ----------------- #
# ウィンドウの振る舞い #
# ----------------- #

## ウィンドウ番号1から開始する
set -g base-index 1

# ペインのインデックスを1から始める
set -gw pane-base-index 1

# ウィンドウ(タブ)を閉じた時、ウインドウ番号を付番をしなおす
set -g renumber-windows on

# =============== #
# 色とスタイル設定 #
# =============== #

# 色コード: http://www.calmar.ws/vim/256-xterm-24bit-rgb-color-chart.html

# TrueColorサポート
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",*256col*:Tc"

# ペインの境界線スタイル
set -g pane-border-style fg=colour240
set -g pane-active-border-style fg=colour51

# ウィンドウスタイル
set -gw window-status-style fg=cyan,bg=default,dim
set -gw window-status-current-style fg=white,bg=black,bright
set -gw window-status-last-style fg=blue,bg=default,bright

# コピーモードの色
set -gw mode-style fg=colour3,bg=colour0

# コマンドラインの色
set -g message-style fg=black,bg=yellow,bright

# フォーカスイベントを有効化（ペインdim機能に必要）
set -g focus-events on

# ペイン切り替え時にスタイルを強制適用（Vimのcolorscheme上書き対策）
set-hook -g pane-focus-out 'select-pane -P bg=colour240,fg=colour247'
set-hook -g pane-focus-in 'select-pane -P bg=default,fg=default'

# ステータスバーを設定する
# ステータスバーの位置
set -g status-position bottom

# ステータスバーの色を設定する
set -g status-style fg=white,bg=black

# tmuxウィンドウのタイトルをiTerm2タブ/ウィンドウのタイトルとして表示される
# https://qiita.com/yamasaki-masahide/items/2a9991631fc06cbbc345
set -g set-titles on
set -g set-titles-string '#T'

## 左パネルを設定する
set -g status-left-length 40
set -g status-left "#[fg=green]Session: #S #[fg=yellow]Window: #I #[fg=cyan]Pane: #P #{prefix_highlight}"

## 右パネルを設定する
set -g status-right "#[fg=blue]"

# prefixキーをC-tに変更する
set -g prefix C-t

# C-bのキーバインドを解除する
unbind C-b

# キーストロークのディレイを減らす
set -sg escape-time 1


# 設定ファイルをリロードする
bind r source-file ~/.tmux.conf \; display "Reloaded!"

# C-t*2でtmux内のプログラムにC-tを送る
bind C-t send-prefix

# vでペインを縦に分割する
bind % split-window -h -c "#{pane_current_path}"

# sでペインを横に分割する
bind '"' split-window -v -c "#{pane_current_path}"

# cで新しいウィンドウを現在ディレクトリで開く
bind c new-window -c "#{pane_current_path}"

# Shift + 上下左右でペインを移動できるようにする。(＜Prefix＞不要)
# 行頭に"bind -n"をつけるとPrefixが不要になる。
bind -n S-left select-pane -L
bind -n S-down select-pane -D
bind -n S-up select-pane -U
bind -n S-right select-pane -R
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Vimのキーバインドでペインをリサイズする
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# ウィンドウ選択画面
bind W choose-window
# 分割していたペインそれぞれをWindowに
bind b break-pane

bind w kill-window
bind q kill-session

# ペイン終了
bind x kill-pane
# ペイン番号表示
bind i display-panes

# synchronized-pane
bind S set-window-option synchronize-panes

# コピーモード突入
bind -n C-Space copy-mode
# ペースト
bind y paste-buffer

# マウス操作を有効にする
# これを有効にすると、MacでCommand+Cなどができなくなるが、Optionを押しながら範囲選択すると、コピーできる。
# http://qiita.com/jyotti/items/70a3a8035d767f99f93d
set -g mouse on
# リフレッシュの間隔を設定する(ステータスバー右が空なので無効化)
set -g status-interval 0
## ウィンドウリストの位置を中心寄せにする
set -g status-justify centre
## ヴィジュアルノーティフィケーションを有効にする
set -gw monitor-activity on
set -g visual-activity on

# スクロールできる上限を増やす
set -g history-limit 10000

# ターミナルウィンドウをリサイズした時にペインの比率を均等にする
set-hook -g client-resized 'select-layout tiled'

# ダブルクリックでタイルレイアウトに変更
bind -n DoubleClick1Pane select-layout tiled

# コピーモードを設定する
## viのキーバインドを使用する
# set -gw mode-keys vi
set -gw mode-keys vi
## コピーモードの操作をvi風に設定する
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
bind-key -T copy-mode-vi Enter send-keys -X copy-selection
bind-key -T copy-mode-vi u send-keys -X halfpage-up
bind-key -T copy-mode-vi d send-keys -X halfpage-down

# C-vで矩形選択の切り替え
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle
# Yで1行ヤンク
bind -T copy-mode-vi Y send-keys -X copy-line


#####################################
###### for Tmux Plugin Manager ######
#####################################


# List of plugins
set -g @plugin 'jaclu/tmux-menus'
set -g @plugin 'nhdaly/tmux-scroll-copy-mode'
set -g @plugin 'roosta/tmux-pop'
set -g @plugin 'tmux-plugins/tmux-open'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
set -g @plugin 'tmux-plugins/tpm'

# tmux-menus
set -g @menus_trigger Space

# tmux-prefix-highlight
set -g @prefix_highlight_show_copy_mode 'on'
set -g @prefix_highlight_show_sync_mode 'on'
set -g @prefix_highlight_copy_prompt ' ⧉ COPY⧉ '
set -g @prefix_highlight_sync_prompt ' ⚏ SYNC⚏ '

# ========== #
# その他設定 #
# ========== #

# ペイン番号の表示時間延長(デフォルト1秒は短い)
set -g display-panes-time 3000

# ウィンドウ名の自動変更を抑制
set -gw automatic-rename off
set -g allow-rename off

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
